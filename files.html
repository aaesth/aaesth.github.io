<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>gitree</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        ul {
            list-style-type: none;
        }
        li {
            margin-left: 20px;
            cursor: pointer;
        }
        li.folder::before {
            content: '📁 ';
        }
        li.file::before {
            content: '📄 ';
        }
        .nested {
            display: none;
        }
        .folder.open > .nested {
            display: block;
        }
    </style>
</head>
<body>
    <h1>repo tree</h1>
    <ul id="repo-tree"></ul>

    <script>
        const owner = "aaesth";
        const repo = "files";
        const branch = "main";

        async function fetchRepoTree() {
            const apiUrl = `https://api.github.com/repos/${owner}/${repo}/git/trees/${branch}?recursive=1`;
            const response = await fetch(apiUrl);
            const data = await response.json();
            const tree = data.tree;

            const rootUl = document.getElementById('repo-tree');
            const folderStructure = buildFolderStructure(tree);
            createTreeUI(rootUl, folderStructure);
        }

        function buildFolderStructure(tree) {
            const folders = {};

            tree.forEach(item => {
                const parts = item.path.split('/');
                let current = folders;

                parts.forEach((part, index) => {
                    if (!current[part]) {
                        current[part] = { __type: index === parts.length - 1 ? item.type : 'tree' };
                    }
                    current = current[part];
                });
            });

            return folders;
        }

        function createTreeUI(parentUl, folder) {
            Object.keys(folder).forEach(key => {
                const li = document.createElement('li');
                li.classList.add(folder[key].__type === 'tree' ? 'folder' : 'file');
                li.textContent = key;
                parentUl.appendChild(li);

                if (folder[key].__type === 'tree') {
                    const subUl = document.createElement('ul');
                    subUl.classList.add('nested');
                    li.appendChild(subUl);
                    createTreeUI(subUl, folder[key]);

                    li.addEventListener('click', function (e) {
                        e.stopPropagation();
                        li.classList.toggle('open');
                    });
                } else {
                    const fileLink = document.createElement('a');
                    fileLink.href = `https://raw.githubusercontent.com/aaesth/${repo}/${branch}/${folder[key].path}`;
                    fileLink.textContent = key;
                    li.textContent = '';
                    li.appendChild(fileLink);
                }
            });
        }

        fetchRepoTree();
    </script>
</body>
</html>
